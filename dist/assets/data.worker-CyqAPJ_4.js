(function(){"use strict";function ze(){return this._array=null,Promise.resolve()}function Be(){var e=this._array;return this._array=null,Promise.resolve(e?{done:!1,value:e}:{done:!0,value:void 0})}function he(e){return new ge(e instanceof Uint8Array?e:new Uint8Array(e))}function ge(e){this._array=e}ge.prototype.read=Be,ge.prototype.cancel=ze;function je(e){return fetch(e).then(function(n){return n.body&&n.body.getReader?n.body.getReader():n.arrayBuffer().then(he)})}function We(e){return new Promise(function(n,s){var a=new XMLHttpRequest;a.responseType="arraybuffer",a.onload=function(){n(he(a.response))},a.onerror=s,a.ontimeout=s,a.open("GET",e,!0),a.send()})}function _e(e){return(typeof fetch=="function"?je:We)(e)}function Se(e){return typeof e.read=="function"?e:e.getReader()}var ye=new Uint8Array(0);function $e(){return this._source.cancel()}function qe(e,n){if(!e.length)return n;if(!n.length)return e;var s=new Uint8Array(e.length+n.length);return s.set(e),s.set(n,e.length),s}function Ke(){var e=this,n=e._array.subarray(e._index);return e._source.read().then(function(s){return e._array=ye,e._index=0,s.done?n.length>0?{done:!1,value:n}:{done:!0,value:void 0}:{done:!1,value:qe(n,s.value)}})}function He(e){if((e|=0)<0)throw new Error("invalid length");var n=this,s=this._array.length-this._index;if(this._index+e<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=e));var a=new Uint8Array(e);return a.set(this._array.subarray(this._index)),function h(){return n._source.read().then(function(c){return c.done?(n._array=ye,n._index=0,s>0?a.subarray(0,s):null):s+c.value.length>=e?(n._array=c.value,n._index=e-s,a.set(c.value.subarray(0,e-s),s),a):(a.set(c.value,s),s+=c.value.length,h())})}()}function Re(e){return typeof e.slice=="function"?e:new ce(typeof e.read=="function"?e:e.getReader())}function ce(e){this._source=e,this._array=ye,this._index=0}ce.prototype.read=Ke,ce.prototype.slice=He,ce.prototype.cancel=$e;function Qe(){return this._source.cancel()}function Ve(e){return/^[nf]$/i.test(e)?!1:/^[yt]$/i.test(e)?!0:null}function Ge(e){return new Date(+e.substring(0,4),e.substring(4,6)-1,+e.substring(6,8))}function de(e){return!(e=e.trim())||isNaN(e=+e)?null:e}function Je(e){return e.trim()||null}var Ye={B:de,C:Je,D:Ge,F:de,L:Ve,M:de,N:de};function Ze(){var e=this,n=1;return e._source.slice(e._recordLength).then(function(s){return s&&s[0]!==26?{done:!1,value:e._fields.reduce(function(a,h){return a[h.name]=Ye[h.type](e._decode(s.subarray(n,n+=h.length))),a},{})}:{done:!0,value:void 0}})}function se(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Xe(e,n){return e=Re(e),e.slice(32).then(function(s){var a=se(s);return e.slice(a.getUint16(8,!0)-32).then(function(h){return new xe(e,n,a,se(h))})})}function xe(e,n,s,a){this._source=e,this._decode=n.decode.bind(n),this._recordLength=s.getUint16(10,!0),this._fields=[];for(var h=0;a.getUint8(h)!==13;h+=32){for(var c=0;c<11&&a.getUint8(h+c)!==0;++c);this._fields.push({name:this._decode(new Uint8Array(a.buffer,a.byteOffset+h,c)),type:String.fromCharCode(a.getUint8(h+11)),length:a.getUint8(h+16)})}}var Ce=xe.prototype;Ce.read=Ze,Ce.cancel=Qe;function et(){return this._source.cancel()}function me(e){var n=40,s,a=e.getInt32(36,!0),h=new Array(a);for(s=0;s<a;++s,n+=16)h[s]=[e.getFloat64(n,!0),e.getFloat64(n+8,!0)];return{type:"MultiPoint",coordinates:h}}function tt(){return null}function ve(e){return{type:"Point",coordinates:[e.getFloat64(4,!0),e.getFloat64(12,!0)]}}function we(e){var n=44,s,a=e.getInt32(36,!0),h=e.getInt32(40,!0),c=new Array(a),g=new Array(h),S=[],N=[];for(s=0;s<a;++s,n+=4)c[s]=e.getInt32(n,!0);for(s=0;s<h;++s,n+=16)g[s]=[e.getFloat64(n,!0),e.getFloat64(n+8,!0)];return c.forEach(function(f,I){var m=g.slice(f,c[I+1]);rt(m)?S.push([m]):N.push(m)}),N.forEach(function(f){S.some(function(I){if(nt(I[0],f))return I.push(f),!0})||S.push([f])}),S.length===1?{type:"Polygon",coordinates:S[0]}:{type:"MultiPolygon",coordinates:S}}function rt(e){if((s=e.length)<4)return!1;for(var n=0,s,a=e[s-1][1]*e[0][0]-e[s-1][0]*e[0][1];++n<s;)a+=e[n-1][1]*e[n][0]-e[n-1][0]*e[n][1];return a>=0}function nt(e,n){for(var s=-1,a=n.length,h;++s<a;)if(h=it(e,n[s]))return h>0;return!1}function it(e,n){for(var s=n[0],a=n[1],h=-1,c=0,g=e.length,S=g-1;c<g;S=c++){var N=e[c],f=N[0],I=N[1],m=e[S],ee=m[0],$=m[1];if(st(N,m,n))return 0;I>a!=$>a&&s<(ee-f)*(a-I)/($-I)+f&&(h=-h)}return h}function st(e,n,s){var a=s[0]-e[0],h=s[1]-e[1];if(a===0&&h===0)return!0;var c=n[0]-e[0],g=n[1]-e[1];if(c===0&&g===0)return!1;var S=(a*c+h*g)/(c*c+g*g);return S<0||S>1?!1:S===0||S===1?!0:S*c===a&&S*g===h}function ke(e){var n=44,s,a=e.getInt32(36,!0),h=e.getInt32(40,!0),c=new Array(a),g=new Array(h);for(s=0;s<a;++s,n+=4)c[s]=e.getInt32(n,!0);for(s=0;s<h;++s,n+=16)g[s]=[e.getFloat64(n,!0),e.getFloat64(n+8,!0)];return a===1?{type:"LineString",coordinates:g}:{type:"MultiLineString",coordinates:c.map(function(S,N){return g.slice(S,c[N+1])})}}function Ae(e,n){var s=new Uint8Array(e.length+n.length);return s.set(e,0),s.set(n,e.length),s}function at(){var e=this;return++e._index,e._source.slice(12).then(function(n){if(n==null)return{done:!0,value:void 0};var s=se(n);function a(){return e._source.slice(4).then(function(c){return c==null?{done:!0,value:void 0}:(s=se(n=Ae(n.slice(4),c)),s.getInt32(0,!1)!==e._index?a():h())})}function h(){var c=s.getInt32(4,!1)*2-4,g=s.getInt32(8,!0);return c<0||g&&g!==e._type?a():e._source.slice(c).then(function(S){return{done:!1,value:g?e._parse(se(Ae(n.slice(8),S))):null}})}return h()})}var Ie={0:tt,1:ve,3:ke,5:we,8:me,11:ve,13:ke,15:we,18:me,21:ve,23:ke,25:we,28:me};function ot(e){return e=Re(e),e.slice(100).then(function(n){return new Oe(e,se(n))})}function Oe(e,n){var s=n.getInt32(32,!0);if(!(s in Ie))throw new Error("unsupported shape type: "+s);this._source=e,this._type=s,this._index=0,this._parse=Ie[s],this.bbox=[n.getFloat64(36,!0),n.getFloat64(44,!0),n.getFloat64(52,!0),n.getFloat64(60,!0)]}var De=Oe.prototype;De.read=at,De.cancel=et;function ut(){}function ft(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(ut)}function lt(){var e=this;return Promise.all([e._dbf?e._dbf.read():{value:{}},e._shp.read()]).then(function(n){var s=n[0],a=n[1];return a.done?a:{done:!1,value:{type:"Feature",properties:s.value,geometry:a.value}}})}function ht(e,n,s){return Promise.all([ot(e),n&&Xe(n,s)]).then(function(a){return new Te(a[0],a[1])})}function Te(e,n){this._shp=e,this._dbf=n,this.bbox=e.bbox}var Fe=Te.prototype;Fe.read=lt,Fe.cancel=ft;function ct(e,n,s){return typeof n=="string"?(/\.dbf$/.test(n)||(n+=".dbf"),n=_e(n)):n instanceof ArrayBuffer||n instanceof Uint8Array?n=he(n):n!=null&&(n=Se(n)),typeof e=="string"?(/\.shp$/.test(e)||(e+=".shp"),n===void 0&&(n=_e(e.substring(0,e.length-4)+".dbf").catch(function(){})),e=_e(e)):e instanceof ArrayBuffer||e instanceof Uint8Array?e=he(e):e=Se(e),Promise.all([e,n]).then(function(a){var h=a[0],c=a[1],g="windows-1252";return ht(h,c,c&&new TextDecoder(g))})}function dt(e,n,s){return ct(e,n).then(function(a){var h=[],c={type:"FeatureCollection",features:h,bbox:a.bbox};return a.read().then(function g(S){return S.done?c:(h.push(S.value),a.read().then(g))})})}var pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Le={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(e,n){((s,a)=>{e.exports=a()})(pt,function s(){var a=typeof self<"u"?self:typeof window<"u"?window:a!==void 0?a:{},h,c=!a.document&&!!a.postMessage,g=a.IS_PAPA_WORKER||!1,S={},N=0,f={};function I(t){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(r){var i=be(r);i.chunkSize=parseInt(i.chunkSize),r.step||r.chunk||(i.chunkSize=null),this._handle=new pe(i),(this._handle.streamer=this)._config=i}).call(this,t),this.parseChunk=function(r,i){var u=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<u){let v=this._config.newline;v||(o=this._config.quoteChar||'"',v=this._handle.guessLineEndings(r,o)),r=[...r.split(v).slice(u)].join(v)}this.isFirstChunk&&C(this._config.beforeFirstChunk)&&(o=this._config.beforeFirstChunk(r))!==void 0&&(r=o),this.isFirstChunk=!1,this._halted=!1;var u=this._partialLine+r,o=(this._partialLine="",this._handle.parse(u,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(r=o.meta.cursor,u=(this._finished||(this._partialLine=u.substring(r-this._baseIndex),this._baseIndex=r),o&&o.data&&(this._rowCount+=o.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),g)a.postMessage({results:o,workerId:f.WORKER_ID,finished:u});else if(C(this._config.chunk)&&!i){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=o=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!u||!C(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),u||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(r){C(this._config.error)?this._config.error(r):g&&this._config.error&&a.postMessage({workerId:f.WORKER_ID,error:r,finished:!1})}}function m(t){var r;(t=t||{}).chunkSize||(t.chunkSize=f.RemoteChunkSize),I.call(this,t),this._nextChunk=c?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(i){this._input=i,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(r=new XMLHttpRequest,this._config.withCredentials&&(r.withCredentials=this._config.withCredentials),c||(r.onload=re(this._chunkLoaded,this),r.onerror=re(this._chunkError,this)),r.open(this._config.downloadRequestBody?"POST":"GET",this._input,!c),this._config.downloadRequestHeaders){var i,u=this._config.downloadRequestHeaders;for(i in u)r.setRequestHeader(i,u[i])}var o;this._config.chunkSize&&(o=this._start+this._config.chunkSize-1,r.setRequestHeader("Range","bytes="+this._start+"-"+o));try{r.send(this._config.downloadRequestBody)}catch(v){this._chunkError(v.message)}c&&r.status===0&&this._chunkError()}},this._chunkLoaded=function(){r.readyState===4&&(r.status<200||400<=r.status?this._chunkError():(this._start+=this._config.chunkSize||r.responseText.length,this._finished=!this._config.chunkSize||this._start>=(i=>(i=i.getResponseHeader("Content-Range"))!==null?parseInt(i.substring(i.lastIndexOf("/")+1)):-1)(r),this.parseChunk(r.responseText)))},this._chunkError=function(i){i=r.statusText||i,this._sendError(new Error(i))}}function ee(t){(t=t||{}).chunkSize||(t.chunkSize=f.LocalChunkSize),I.call(this,t);var r,i,u=typeof FileReader<"u";this.stream=function(o){this._input=o,i=o.slice||o.webkitSlice||o.mozSlice,u?((r=new FileReader).onload=re(this._chunkLoaded,this),r.onerror=re(this._chunkError,this)):r=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var o=this._input,v=(this._config.chunkSize&&(v=Math.min(this._start+this._config.chunkSize,this._input.size),o=i.call(o,this._start,v)),r.readAsText(o,this._config.encoding));u||this._chunkLoaded({target:{result:v}})},this._chunkLoaded=function(o){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(o.target.result)},this._chunkError=function(){this._sendError(r.error)}}function $(t){var r;I.call(this,t=t||{}),this.stream=function(i){return r=i,this._nextChunk()},this._nextChunk=function(){var i,u;if(!this._finished)return i=this._config.chunkSize,r=i?(u=r.substring(0,i),r.substring(i)):(u=r,""),this._finished=!r,this.parseChunk(u)}}function ie(t){I.call(this,t=t||{});var r=[],i=!0,u=!1;this.pause=function(){I.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){I.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(o){this._input=o,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){u&&r.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),r.length?this.parseChunk(r.shift()):i=!0},this._streamData=re(function(o){try{r.push(typeof o=="string"?o:o.toString(this._config.encoding)),i&&(i=!1,this._checkIsFinished(),this.parseChunk(r.shift()))}catch(v){this._streamError(v)}},this),this._streamError=re(function(o){this._streamCleanUp(),this._sendError(o)},this),this._streamEnd=re(function(){this._streamCleanUp(),u=!0,this._streamData("")},this),this._streamCleanUp=re(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function pe(t){var r,i,u,o,v=Math.pow(2,53),P=-v,K=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,H=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,w=this,D=0,d=0,j=!1,_=!1,k=[],l={data:[],errors:[],meta:{}};function M(b){return t.skipEmptyLines==="greedy"?b.join("").trim()==="":b.length===1&&b[0].length===0}function L(){if(l&&u&&(Q("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+f.DefaultDelimiter+"'"),u=!1),t.skipEmptyLines&&(l.data=l.data.filter(function(p){return!M(p)})),B()){let p=function(F,U){C(t.transformHeader)&&(F=t.transformHeader(F,U)),k.push(F)};if(l)if(Array.isArray(l.data[0])){for(var b=0;B()&&b<l.data.length;b++)l.data[b].forEach(p);l.data.splice(0,1)}else l.data.forEach(p)}function R(p,F){for(var U=t.header?{}:[],x=0;x<p.length;x++){var A=x,E=p[x],E=((V,y)=>(O=>(t.dynamicTypingFunction&&t.dynamicTyping[O]===void 0&&(t.dynamicTyping[O]=t.dynamicTypingFunction(O)),(t.dynamicTyping[O]||t.dynamicTyping)===!0))(V)?y==="true"||y==="TRUE"||y!=="false"&&y!=="FALSE"&&((O=>{if(K.test(O)&&(O=parseFloat(O),P<O&&O<v))return 1})(y)?parseFloat(y):H.test(y)?new Date(y):y===""?null:y):y)(A=t.header?x>=k.length?"__parsed_extra":k[x]:A,E=t.transform?t.transform(E,A):E);A==="__parsed_extra"?(U[A]=U[A]||[],U[A].push(E)):U[A]=E}return t.header&&(x>k.length?Q("FieldMismatch","TooManyFields","Too many fields: expected "+k.length+" fields but parsed "+x,d+F):x<k.length&&Q("FieldMismatch","TooFewFields","Too few fields: expected "+k.length+" fields but parsed "+x,d+F)),U}var T;l&&(t.header||t.dynamicTyping||t.transform)&&(T=1,!l.data.length||Array.isArray(l.data[0])?(l.data=l.data.map(R),T=l.data.length):l.data=R(l.data,0),t.header&&l.meta&&(l.meta.fields=k),d+=T)}function B(){return t.header&&k.length===0}function Q(b,R,T,p){b={type:b,code:R,message:T},p!==void 0&&(b.row=p),l.errors.push(b)}C(t.step)&&(o=t.step,t.step=function(b){l=b,B()?L():(L(),l.data.length!==0&&(D+=b.data.length,t.preview&&D>t.preview?i.abort():(l.data=l.data[0],o(l,w))))}),this.parse=function(b,R,T){var p=t.quoteChar||'"',p=(t.newline||(t.newline=this.guessLineEndings(b,p)),u=!1,t.delimiter?C(t.delimiter)&&(t.delimiter=t.delimiter(b),l.meta.delimiter=t.delimiter):((p=((F,U,x,A,E)=>{var V,y,O,ne;E=E||[",","	","|",";",f.RECORD_SEP,f.UNIT_SEP];for(var oe=0;oe<E.length;oe++){for(var J,fe=E[oe],W=0,Y=0,z=0,q=(O=void 0,new ae({comments:A,delimiter:fe,newline:U,preview:10}).parse(F)),X=0;X<q.data.length;X++)x&&M(q.data[X])?z++:(J=q.data[X].length,Y+=J,O===void 0?O=J:0<J&&(W+=Math.abs(J-O),O=J));0<q.data.length&&(Y/=q.data.length-z),(y===void 0||W<=y)&&(ne===void 0||ne<Y)&&1.99<Y&&(y=W,V=fe,ne=Y)}return{successful:!!(t.delimiter=V),bestDelimiter:V}})(b,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess)).successful?t.delimiter=p.bestDelimiter:(u=!0,t.delimiter=f.DefaultDelimiter),l.meta.delimiter=t.delimiter),be(t));return t.preview&&t.header&&p.preview++,r=b,i=new ae(p),l=i.parse(r,R,T),L(),j?{meta:{paused:!0}}:l||{meta:{paused:!1}}},this.paused=function(){return j},this.pause=function(){j=!0,i.abort(),r=C(t.chunk)?"":r.substring(i.getCharIndex())},this.resume=function(){w.streamer._halted?(j=!1,w.streamer.parseChunk(r,!0)):setTimeout(w.resume,3)},this.aborted=function(){return _},this.abort=function(){_=!0,i.abort(),l.meta.aborted=!0,C(t.complete)&&t.complete(l),r=""},this.guessLineEndings=function(F,p){F=F.substring(0,1048576);var p=new RegExp(te(p)+"([^]*?)"+te(p),"gm"),T=(F=F.replace(p,"")).split("\r"),p=F.split(`
`),F=1<p.length&&p[0].length<T[0].length;if(T.length===1||F)return`
`;for(var U=0,x=0;x<T.length;x++)T[x][0]===`
`&&U++;return U>=T.length/2?`\r
`:"\r"}}function te(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ae(t){var r=(t=t||{}).delimiter,i=t.newline,u=t.comments,o=t.step,v=t.preview,P=t.fastMode,K=null,H=!1,w=t.quoteChar==null?'"':t.quoteChar,D=w;if(t.escapeChar!==void 0&&(D=t.escapeChar),(typeof r!="string"||-1<f.BAD_DELIMITERS.indexOf(r))&&(r=","),u===r)throw new Error("Comment character same as delimiter");u===!0?u="#":(typeof u!="string"||-1<f.BAD_DELIMITERS.indexOf(u))&&(u=!1),i!==`
`&&i!=="\r"&&i!==`\r
`&&(i=`
`);var d=0,j=!1;this.parse=function(_,k,l){if(typeof _!="string")throw new Error("Input must be a string");var M=_.length,L=r.length,B=i.length,Q=u.length,b=C(o),R=[],T=[],p=[],F=d=0;if(!_)return W();if(P||P!==!1&&_.indexOf(w)===-1){for(var U=_.split(i),x=0;x<U.length;x++){if(p=U[x],d+=p.length,x!==U.length-1)d+=i.length;else if(l)return W();if(!u||p.substring(0,Q)!==u){if(b){if(R=[],ne(p.split(r)),Y(),j)return W()}else ne(p.split(r));if(v&&v<=x)return R=R.slice(0,v),W(!0)}}return W()}for(var A=_.indexOf(r,d),E=_.indexOf(i,d),V=new RegExp(te(D)+te(w),"g"),y=_.indexOf(w,d);;)if(_[d]===w)for(y=d,d++;;){if((y=_.indexOf(w,y+1))===-1)return l||T.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:R.length,index:d}),J();if(y===M-1)return J(_.substring(d,y).replace(V,w));if(w===D&&_[y+1]===D)y++;else if(w===D||y===0||_[y-1]!==D){A!==-1&&A<y+1&&(A=_.indexOf(r,y+1));var O=oe((E=E!==-1&&E<y+1?_.indexOf(i,y+1):E)===-1?A:Math.min(A,E));if(_.substr(y+1+O,L)===r){p.push(_.substring(d,y).replace(V,w)),_[d=y+1+O+L]!==w&&(y=_.indexOf(w,d)),A=_.indexOf(r,d),E=_.indexOf(i,d);break}if(O=oe(E),_.substring(y+1+O,y+1+O+B)===i){if(p.push(_.substring(d,y).replace(V,w)),fe(y+1+O+B),A=_.indexOf(r,d),y=_.indexOf(w,d),b&&(Y(),j))return W();if(v&&R.length>=v)return W(!0);break}T.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:R.length,index:d}),y++}}else if(u&&p.length===0&&_.substring(d,d+Q)===u){if(E===-1)return W();d=E+B,E=_.indexOf(i,d),A=_.indexOf(r,d)}else if(A!==-1&&(A<E||E===-1))p.push(_.substring(d,A)),d=A+L,A=_.indexOf(r,d);else{if(E===-1)break;if(p.push(_.substring(d,E)),fe(E+B),b&&(Y(),j))return W();if(v&&R.length>=v)return W(!0)}return J();function ne(z){R.push(z),F=d}function oe(z){var q=0;return q=z!==-1&&(z=_.substring(y+1,z))&&z.trim()===""?z.length:q}function J(z){return l||(z===void 0&&(z=_.substring(d)),p.push(z),d=M,ne(p),b&&Y()),W()}function fe(z){d=z,ne(p),p=[],E=_.indexOf(i,d)}function W(z){if(t.header&&!k&&R.length&&!H){var q=R[0],X=Object.create(null),Ee=new Set(q);let Ue=!1;for(let ue=0;ue<q.length;ue++){let Z=q[ue];if(X[Z=C(t.transformHeader)?t.transformHeader(Z,ue):Z]){let le,Ne=X[Z];for(;le=Z+"_"+Ne,Ne++,Ee.has(le););Ee.add(le),q[ue]=le,X[Z]++,Ue=!0,(K=K===null?{}:K)[le]=Z}else X[Z]=1,q[ue]=Z;Ee.add(Z)}Ue&&console.warn("Duplicate headers found and renamed."),H=!0}return{data:R,errors:T,meta:{delimiter:r,linebreak:i,aborted:j,truncated:!!z,cursor:F+(k||0),renamedHeaders:K}}}function Y(){o(W()),R=[],T=[]}},this.abort=function(){j=!0},this.getCharIndex=function(){return d}}function G(t){var r=t.data,i=S[r.workerId],u=!1;if(r.error)i.userError(r.error,r.file);else if(r.results&&r.results.data){var o={abort:function(){u=!0,Pe(r.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Me,resume:Me};if(C(i.userStep)){for(var v=0;v<r.results.data.length&&(i.userStep({data:r.results.data[v],errors:r.results.errors,meta:r.results.meta},o),!u);v++);delete r.results}else C(i.userChunk)&&(i.userChunk(r.results,o,r.file),delete r.results)}r.finished&&!u&&Pe(r.workerId,r.results)}function Pe(t,r){var i=S[t];C(i.userComplete)&&i.userComplete(r),i.terminate(),delete S[t]}function Me(){throw new Error("Not implemented.")}function be(t){if(typeof t!="object"||t===null)return t;var r,i=Array.isArray(t)?[]:{};for(r in t)i[r]=be(t[r]);return i}function re(t,r){return function(){t.apply(r,arguments)}}function C(t){return typeof t=="function"}return f.parse=function(t,r){var i=(r=r||{}).dynamicTyping||!1;if(C(i)&&(r.dynamicTypingFunction=i,i={}),r.dynamicTyping=i,r.transform=!!C(r.transform)&&r.transform,!r.worker||!f.WORKERS_SUPPORTED)return i=null,f.NODE_STREAM_INPUT,typeof t=="string"?(t=(u=>u.charCodeAt(0)!==65279?u:u.slice(1))(t),i=new(r.download?m:$)(r)):t.readable===!0&&C(t.read)&&C(t.on)?i=new ie(r):(a.File&&t instanceof File||t instanceof Object)&&(i=new ee(r)),i.stream(t);(i=(()=>{var u;return!!f.WORKERS_SUPPORTED&&(u=(()=>{var o=a.URL||a.webkitURL||null,v=s.toString();return f.BLOB_URL||(f.BLOB_URL=o.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",v,")();"],{type:"text/javascript"})))})(),(u=new a.Worker(u)).onmessage=G,u.id=N++,S[u.id]=u)})()).userStep=r.step,i.userChunk=r.chunk,i.userComplete=r.complete,i.userError=r.error,r.step=C(r.step),r.chunk=C(r.chunk),r.complete=C(r.complete),r.error=C(r.error),delete r.worker,i.postMessage({input:t,config:r,workerId:i.id})},f.unparse=function(t,r){var i=!1,u=!0,o=",",v=`\r
`,P='"',K=P+P,H=!1,w=null,D=!1,d=((()=>{if(typeof r=="object"){if(typeof r.delimiter!="string"||f.BAD_DELIMITERS.filter(function(k){return r.delimiter.indexOf(k)!==-1}).length||(o=r.delimiter),typeof r.quotes!="boolean"&&typeof r.quotes!="function"&&!Array.isArray(r.quotes)||(i=r.quotes),typeof r.skipEmptyLines!="boolean"&&typeof r.skipEmptyLines!="string"||(H=r.skipEmptyLines),typeof r.newline=="string"&&(v=r.newline),typeof r.quoteChar=="string"&&(P=r.quoteChar),typeof r.header=="boolean"&&(u=r.header),Array.isArray(r.columns)){if(r.columns.length===0)throw new Error("Option columns is empty");w=r.columns}r.escapeChar!==void 0&&(K=r.escapeChar+P),r.escapeFormulae instanceof RegExp?D=r.escapeFormulae:typeof r.escapeFormulae=="boolean"&&r.escapeFormulae&&(D=/^[=+\-@\t\r].*$/)}})(),new RegExp(te(P),"g"));if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return j(null,t,H);if(typeof t[0]=="object")return j(w||Object.keys(t[0]),t,H)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields||w),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:typeof t.data[0]=="object"?Object.keys(t.data[0]):[]),Array.isArray(t.data[0])||typeof t.data[0]=="object"||(t.data=[t.data])),j(t.fields||[],t.data||[],H);throw new Error("Unable to serialize unrecognized input");function j(k,l,M){var L="",B=(typeof k=="string"&&(k=JSON.parse(k)),typeof l=="string"&&(l=JSON.parse(l)),Array.isArray(k)&&0<k.length),Q=!Array.isArray(l[0]);if(B&&u){for(var b=0;b<k.length;b++)0<b&&(L+=o),L+=_(k[b],b);0<l.length&&(L+=v)}for(var R=0;R<l.length;R++){var T=(B?k:l[R]).length,p=!1,F=B?Object.keys(l[R]).length===0:l[R].length===0;if(M&&!B&&(p=M==="greedy"?l[R].join("").trim()==="":l[R].length===1&&l[R][0].length===0),M==="greedy"&&B){for(var U=[],x=0;x<T;x++){var A=Q?k[x]:x;U.push(l[R][A])}p=U.join("").trim()===""}if(!p){for(var E=0;E<T;E++){0<E&&!F&&(L+=o);var V=B&&Q?k[E]:E;L+=_(l[R][V],E)}R<l.length-1&&(!M||0<T&&!F)&&(L+=v)}}return L}function _(k,l){var M,L;return k==null?"":k.constructor===Date?JSON.stringify(k).slice(1,25):(L=!1,D&&typeof k=="string"&&D.test(k)&&(k="'"+k,L=!0),M=k.toString().replace(d,K),(L=L||i===!0||typeof i=="function"&&i(k,l)||Array.isArray(i)&&i[l]||((B,Q)=>{for(var b=0;b<Q.length;b++)if(-1<B.indexOf(Q[b]))return!0;return!1})(M,f.BAD_DELIMITERS)||-1<M.indexOf(o)||M.charAt(0)===" "||M.charAt(M.length-1)===" ")?P+M+P:M)}},f.RECORD_SEP="",f.UNIT_SEP="",f.BYTE_ORDER_MARK="\uFEFF",f.BAD_DELIMITERS=["\r",`
`,'"',f.BYTE_ORDER_MARK],f.WORKERS_SUPPORTED=!c&&!!a.Worker,f.NODE_STREAM_INPUT=1,f.LocalChunkSize=10485760,f.RemoteChunkSize=5242880,f.DefaultDelimiter=",",f.Parser=ae,f.ParserHandle=pe,f.NetworkStreamer=m,f.FileStreamer=ee,f.StringStreamer=$,f.ReadableStreamStreamer=ie,a.jQuery&&((h=a.jQuery).fn.parse=function(t){var r=t.config||{},i=[];return this.each(function(v){if(!(h(this).prop("tagName").toUpperCase()==="INPUT"&&h(this).attr("type").toLowerCase()==="file"&&a.FileReader)||!this.files||this.files.length===0)return!0;for(var P=0;P<this.files.length;P++)i.push({file:this.files[P],inputElem:this,instanceConfig:h.extend({},r)})}),u(),this;function u(){if(i.length===0)C(t.complete)&&t.complete();else{var v,P,K,H,w=i[0];if(C(t.before)){var D=t.before(w.file,w.inputElem);if(typeof D=="object"){if(D.action==="abort")return v="AbortError",P=w.file,K=w.inputElem,H=D.reason,void(C(t.error)&&t.error({name:v},P,K,H));if(D.action==="skip")return void o();typeof D.config=="object"&&(w.instanceConfig=h.extend(w.instanceConfig,D.config))}else if(D==="skip")return void o()}var d=w.instanceConfig.complete;w.instanceConfig.complete=function(j){C(d)&&d(j,w.file,w.inputElem),o()},f.parse(w.file,w.instanceConfig)}}function o(){i.splice(0,1),u()}}),g&&(a.onmessage=function(t){t=t.data,f.WORKER_ID===void 0&&t&&(f.WORKER_ID=t.workerId),typeof t.input=="string"?a.postMessage({workerId:f.WORKER_ID,results:f.parse(t.input,t.config),finished:!0}):(a.File&&t.input instanceof File||t.input instanceof Object)&&(t=f.parse(t.input,t.config))&&a.postMessage({workerId:f.WORKER_ID,results:t,finished:!0})}),(m.prototype=Object.create(I.prototype)).constructor=m,(ee.prototype=Object.create(I.prototype)).constructor=ee,($.prototype=Object.create($.prototype)).constructor=$,(ie.prototype=Object.create(I.prototype)).constructor=ie,f})})(Le);var _t=Le.exports,yt=gt(_t);const mt=(e,n)=>{const s=e.toLowerCase();return s.includes("river")?"river":s.includes("canal")?"canal":s.includes("point")||s.includes("weir")?(n&&n.TYPE&&String(n.TYPE).toLowerCase()==="weir","weir"):"canal"};async function vt(){try{console.log("Worker: Starting data load...");const e=await fetch("/0_KERN_RIVER_MASTER_DATA_rev6.csv");if(!e.ok)throw new Error(`Failed to fetch CSV: ${e.statusText}`);const n=await e.text(),s=yt.parse(n,{header:!0,dynamicTyping:!1,skipEmptyLines:!0});console.log(`Worker: CSV parsed. Rows: ${s.data.length}`),s.errors.length>0&&console.warn("Worker: Errors during CSV parsing:",s.errors);const a=new Map;s.data.forEach(g=>{if(!g.MapID)return;const S={};for(const N in g)if(N.match(/^\d{4}$/)){const f=parseFloat(String(g[N]));S[N]=isNaN(f)?0:f}a.set(g.MapID.trim(),S)}),console.log(`Worker: Flow data map created. Entries: ${a.size}`);const h=[{path:"/Canals_KernRiver_Merged_rev/Canals_KernRiver_Merged_rev.shp",typeOverride:null},{path:"/NHDStreamRiverKernRiver_rev/NHDStreamRiverKernRiver_rev.shp",typeOverride:"river"},{path:"/Points_Metro_Bak_Canals_Rev/Points_Metro_Bak_Canals_Rev.shp",typeOverride:"weir"}],c=[];for(const{path:g,typeOverride:S}of h){console.log(`Worker: Processing shapefile: ${g}`);try{const[N,f]=await Promise.all([fetch(g).then(m=>{if(!m.ok)throw new Error(`SHP fetch failed: ${m.statusText}`);return m.arrayBuffer()}),fetch(g.replace(".shp",".dbf")).then(m=>{if(!m.ok)throw new Error(`DBF fetch failed: ${m.statusText}`);return m.arrayBuffer()})]);console.log(`Worker: SHP and DBF fetched for ${g}`);const I=await dt(N,f);console.log(`Worker: Shapefile ${g} read. Features found: ${I.features.length}`),I&&I.features&&I.features.forEach(m=>{const ee=["MAPID","MapID","mapid","SiteID","SITEID"];let $;for(const G of ee)if(m.properties&&m.properties[G]){$=String(m.properties[G]).trim();break}if(!$)return;const ie=a.get($),pe=["NAME","Name","SiteName","GNIS_Name"];let te="Unknown";for(const G of pe)if(m.properties&&m.properties[G]){te=String(m.properties[G]);break}const ae=S||mt(g,m.properties||{});if(m.geometry&&(m.geometry.type==="LineString"||m.geometry.type==="Point"||m.geometry.type==="MultiLineString")){let G=m.geometry;if(m.geometry.type==="MultiLineString")if(m.geometry.coordinates&&m.geometry.coordinates.length>0)G={type:"LineString",coordinates:m.geometry.coordinates[0]};else{console.warn(`Worker: MultiLineString feature for MapID ${$} has no coordinates. Skipping.`);return}c.push({id:$+"_"+ae,geometry:G,properties:{name:te,type:ae,flows:ie||{}}})}})}catch(N){console.error(`Worker: Error processing shapefile ${g}:`,N)}}return console.log("Worker: All data processed. Total features:",c.length),c}catch(e){throw console.error("Worker: Error in loadAndProcessData:",e),e}}self.onmessage=async e=>{if(e.data==="loadData")try{const n=await vt();self.postMessage({type:"dataLoaded",payload:n})}catch(n){self.postMessage({type:"dataError",payload:n.message})}}})();
